<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="MobileOptimized" content="width">
  <meta name="HandheldFriendly" content="true">
  <script type="text/javascript">
    var addThisScriptUrl = 'https://s7.addthis.com/js/300/addthis_widget.js';
  </script>
  <link rel='shortcut icon' href='../_webHelpImages/cloudbolt-login-logo.png' /><link rel='icon' href='../_webHelpImages/cloudbolt-login-logo.png' />
  <link rel='stylesheet' type='text/css' href='../_webHelpStyles/CHWebHelp.css?t=637806378603891771'/><link rel='stylesheet' type='text/css' href='../_webHelpStyles/CommonControls.css?t=637806378603891771'/><link rel='stylesheet' type='text/css' href='../_webHelpStyles/CommonControls/FontAwesome/css/font-awesome.min-ignore.css?t=637806378603891771'/><link rel='stylesheet' type='text/css' href='../_webHelpStyles/z-Branding.css?t=637806378603891771'/>
  <script  src='../_webHelpScripts/Master/1-script.js?t=637806378603891771' type='text/javascript'></script><script  src='../_webHelpScripts/Master/toc_nav.js?t=637806378603891771' type='text/javascript'></script>
  <link rel="stylesheet" href="https://cdn.materialdesignicons.com/5.0.45/css/materialdesignicons.min.css">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<script src="https://kit.fontawesome.com/68d03bdd6e.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
<script type="text/javascript">//<!--
appendEventHandler(window, 'load', function() {webHelpSelectTocNodeByExtId('postgresql-database',true);});
//--></script><title>Upgrade your Database to PostgreSQL</title><script type="text/javascript">//<!--
var articleTitleText='Upgrade your Database to PostgreSQL';
//--></script><link rel="stylesheet" type="text/css" href="../Styles/article-published.css"/><link rel="stylesheet" type="text/css" href="../Styles/cloudbolt-docs/CloudBoltBranding.css"/><script src="../Scripts/article-published.js" type="text/javascript"></script><script src="../Scripts/cloudbolt-docs/Script1.js" type="text/javascript"></script><script src="../Scripts/cloudbolt-docs/Script2.js" type="text/javascript"></script><meta charset="utf-8"><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
  
</head>
<body class="WebHelp_body">
  <div id="pnlContainer" class="CHOffCanvasPanel_container">
    <div class="CHOffCanvasPanel_content">
      <nav id="pnlOffCanvasNav" class="CHOffCanvasPanel_nav noselect">
        <div id="pnlOffCanvasHeader" class="BaseMaster_offCanvasHeader">
        </div>
        <script  type='text/javascript'>//<!--
window['mobileMenu']=new CHMenu('pnlOffCanvasHeader',{"cssClasses":{"menu":null,"popup":null},"templates":{"itemContent":null,"treeItemContent":null,"dropDownArrow":null},"isMobileViewIfParentOverflow":false,"mobileViewMinWidthThreshold":-1,"selectedItemId":"tabContents","isAllowItemSelection":true,"isEscapeMenuItemText":true,"isUseFontAwesomeIcons":true,"fontAwesomeVersion":"4","isMovePopupToBodyChildLevel":true,"isShowPopupOnHover":false},[{"id":"menuItemMenu","t":"Menu","imgs":{},"c":[],"s":-1,"d":0,"e":0,"isNoFocus":false,"vals":{"_faIconCssClass":""}},{"id":"tabContents","t":"Topics","imgs":{},"c":[],"s":-1,"d":0,"e":0,"isNoFocus":false,"vals":{"_faIconCssClass":""}},{"id":"tabSearch","t":"Search","imgs":{},"c":[],"s":-1,"d":0,"e":0,"isNoFocus":false,"vals":{"_faIconCssClass":""}}]);window['mobileMenu'].onItemClick=function(s,e){webHelpMobileMenuItemClick(s,e);};
//--></script>
        <div id="pnlOffCanvasContent" class="BaseMaster_offCanvasContent">
        </div>        
      </nav>
      <div id="pnlOffCanvasOverlay" class="CHOffCanvasPanel_overlay"></div>
      <nav id="pnlMainMenuContainer" class="BaseMaster_mainMenuContainer">
        <button type="button" aria-label="Show mobile menu" title="Show mobile menu" id="btnMobileMenu" style="display:none"
          class="CHHamburger_container CHHamburger_container-htla BaseMaster_hamburgerMenuIcon">
          <span></span>
        </button>
        <a title='CloudBolt Software' href='https://cloudbolt.io' target='_blank'><img alt='CloudBolt Software' class='BaseMaster_imgLogo' src='../_webHelpImages/cloudbolt_line_transparent_white_FINAL.png' /></a>
        <div id="pnlMainMenu" class="BaseMaster_pnlMainMenu"></div>
        <script  type='text/javascript'>//<!--
window['mainMenu']=new CHMenu('pnlMainMenu',{"cssClasses":{"menu":null,"popup":null},"templates":{"itemContent":null,"treeItemContent":null,"dropDownArrow":null},"isMobileViewIfParentOverflow":true,"mobileViewMinWidthThreshold":979,"selectedItemId":null,"isAllowItemSelection":false,"isEscapeMenuItemText":true,"isUseFontAwesomeIcons":true,"fontAwesomeVersion":"4","isMovePopupToBodyChildLevel":true,"isShowPopupOnHover":false},[{"id":"926ab37c-af98-eab8-2cb6-f0224c32b59e","t":"Getting Support","imgs":{},"c":[],"s":0,"d":0,"e":1,"isNoFocus":false,"vals":{"actionType":"OpenLink","_customCssClass":null,"_url":"https://support.cloudbolt.io/","_target":"_blank"}},{"id":"a93dc193-cfa0-0c55-dc87-ef748c016d3e","t":"CloudBolt API","imgs":{},"c":[],"s":0,"d":0,"e":1,"isNoFocus":false,"vals":{"actionType":"OpenArticle","_customCssClass":null,"_url":"http://docs.cloudbolt.io/articles/cloudbolt-latest-docs/cloudbolt-api-v3","_target":"_blank"}},{"id":"1d7d67de-8445-1336-084c-3d22cc440080","t":"Documentation Portal","imgs":{},"c":[],"s":0,"d":0,"e":1,"isNoFocus":false,"vals":{"actionType":"OpenLink","_customCssClass":null,"_url":"https://docs.cloudbolt.io/"}},{"id":"d4ac0703-4b0e-d846-4521-45b57775c8f2","t":"Knowledge Base","imgs":{},"c":[],"s":0,"d":0,"e":1,"isNoFocus":false,"vals":{"actionType":"OpenLink","_customCssClass":null,"_url":"https://support.cloudbolt.io/hc/en-us/sections/201319545-Knowledge-Base","_target":"_blank"}}]);window['mainMenu'].onViewSwitched=function(s,e){webHelpMasterPageMainMenuViewSwitched(s,e);};
//--></script>
        <div class="WebHelp_searchBoxContainer">
          <input id="edtSearch" type="search" class="WebHelp_searchBox" aria-label="Search" />
          <button id="btnSearch" class="btnSearch" alt="Search" title="Search" aria-label="Search" href="javascript:void(0)"></button>
        </div>
      </nav>
      <div id="pnlContentContainer" class="BaseMaster_contentContainer clearfix">
        <nav id="pnlArticlesNav" class="WebHelp_navPanel">
          <div id="pnlNavTabs" class="WebHelp_navMenu"></div>
          <script  type='text/javascript'>//<!--
window['navMenu']=new CHMenu('pnlNavTabs',{"cssClasses":{"menu":null,"popup":null},"templates":{"itemContent":null,"treeItemContent":null,"dropDownArrow":null},"isMobileViewIfParentOverflow":false,"mobileViewMinWidthThreshold":-1,"selectedItemId":"tabContents","isAllowItemSelection":true,"isEscapeMenuItemText":true,"isUseFontAwesomeIcons":true,"fontAwesomeVersion":"4","isMovePopupToBodyChildLevel":true,"isShowPopupOnHover":false},[{"id":"tabContents","t":"Topics","imgs":{},"c":[],"s":-1,"d":0,"e":0,"isNoFocus":false,"vals":{"_faIconCssClass":""}},{"id":"tabSearch","t":"Search","imgs":{},"c":[],"s":-1,"d":0,"e":0,"isNoFocus":false,"vals":{"_faIconCssClass":""}}]);window['navMenu'].onItemClick=function(s,e){webHelpNavMenuItemClick(s,e);};
//--></script>
          <div id="pnlTocContainer" class="WebHelp_navPanelContent ArticleSelector_tabContent TocTreeLight_container">
            <div id="pnlToc"></div>
          </div>
          <div id="pnlIndex" class="WebHelp_navPanelContent ArticleSelector_tabContent" style="display:none">
            <iframe id="frameIndex" style="height: 100%; width:100%; display:block;" frameborder="0"></iframe>
          </div>
          <div id="pnlSearch" class="WebHelp_navPanelContent ArticleSelector_tabContent" style="display:none">
            <iframe id="frameSearch" style="height: 100%; width:100%; display: block;" frameborder="0"></iframe>
          </div>
        </nav>
        <article class="TopicViewer_container">
          <header id="pnlTopicHeader" class="TopicViewer_header"  style='display:none'>
            <div id="pnlSocial" class="TopicViewer_headerShare">Share: </div>
            <div class="TopicViewer_headerText">
              <div class="ArticleEditor_projectName">cloudbolt_docs</div>
              <strong id="pnlTitle" class="ArticleEditor_title">Upgrade your Database to PostgreSQL</strong>
              <button type="button" id="btnPrint" class="CHImageButton ArticleEditor_imageButton ArticleEditor_fontAwesomeButton ArticleEditor_btnPrint" title="Print this topic">
                <i class="fa fa-print"></i>
              </button>
            </div>
          </header>
          <div id="pnlTopicContentContainer" class="TopicViewer_contentContainer">
            <!-- START ARTICLE CONTAINER -->
<div class="container">
  <div class="articleBreadcrumb">
    <span class="CHBreadcrumb"><span class="CHBreadcrumb_item CHBreadcrumb_itemHome"><a href="/" target="_top">Home</a></span><span class="CHBreadcrumb_separator">›</span><span class="CHBreadcrumb_item"><a href="upgrading-cloudbolt.html">Upgrading CloudBolt</a></span><span class="CHBreadcrumb_separator">›</span><span class="CHBreadcrumb_item CHBreadcrumb_itemSelf">Upgrade your Database to PostgreSQL</span></span>
  </div><h1 id="h1__246429115" data-has-heading-anchor="true">
  Updating your Database to PostgreSQL 
<a href="postgresql-database.html#h1__246429115" class="CHHeadingLink" title="Link to this heading" aria-hidden="true"></a></h1>
<p class="lead">
  Learn about CloudBolt's PostgreSQL database and how to upgrade your existing instance to use PostgreSQL.
</p>
<p>
  <ul class=""><li class="CHMiniToc_heading2"><a href="postgresql-database.html#h2__1296687178">Introduction</a></li><li class="CHMiniToc_heading2"><a href="postgresql-database.html#h2_1644201065">Prerequisites</a></li><li class="CHMiniToc_heading2"><a href="postgresql-database.html#h2_1223016999">Database Data Migration</a></li><li class="CHMiniToc_heading3"><a href="postgresql-database.html#h3_1462776239">1. Migrate Data</a></li><li class="CHMiniToc_heading3"><a href="postgresql-database.html#h3_592386155">2. Verify Data Migration</a></li><li class="CHMiniToc_heading3"><a href="postgresql-database.html#h3_465749878">3. Confirm Data Migration</a></li><li class="CHMiniToc_heading3"><a href="postgresql-database.html#h3_611604668">4. Disable MySQL and Restart Services</a></li><li class="CHMiniToc_heading2"><a href="postgresql-database.html#h2_362899174">Revert Back to MySQL</a></li><li class="CHMiniToc_heading3"><a href="postgresql-database.html#h3_1295120108">Single Appliance Setup</a></li><li class="CHMiniToc_heading3"><a href="postgresql-database.html#h3__179856090">HA - Distributed Setup</a></li></ul>
</p>
<hr/>
<section>
  <h2 id="h2__1296687178" data-has-heading-anchor="true">
    Introduction
  <a href="postgresql-database.html#h2__1296687178" class="CHHeadingLink" title="Link to this heading" aria-hidden="true"></a></h2>
  <p>
    Starting with CloudBolt version 9.4.7, PostgreSQL is now the recommended database and is the default for all installations version 9.4.7 and greater. 
  </p>
  <p>
    MySQL will continue to be supported for existing customers and new installations. In both cases, you may have to manually install MySQL client and server components. If you are upgrading from release 9.4.6.x, you will not need to perform any manual installations.
  </p>
</section>
<section>
  <h2 id="h2_1644201065" data-has-heading-anchor="true">
    Prerequisites
  <a href="postgresql-database.html#h2_1644201065" class="CHHeadingLink" title="Link to this heading" aria-hidden="true"></a></h2>
  <ul>
    <li>
      Upgrade your instance to 9.4.7 or greater.
      <ul>
        <li>
          If upgrading from a version prior to 9.4.6.x, either upgrade first to 9.4.6.2 then 9.4.7, or manually install the&nbsp;<code>mysqlclient</code>&nbsp;python package.
        </li>
      </ul>
    </li>
    <li>
      For <b>HA Distributed Setups</b>, perform the following:
      <ol>
        <li>
          Put all instances of the Web tier in Maintenance Mode <table class="CHCodeSample_container notranslate" cellspacing="0" cellpadding="0"><tr class="CHCodeSample_tr1"><td class="CHCodeSample_header"><div class="CHCodeSample_copyCode nonPrintable"><a onclick="copyCodeSample(this)" href="javascript:void(0)">Copy Code</a></div><div class="CHCodeSample_langName notranslate">Python</div></td></tr><tr class="CHCodeSample_tr2"><td class="CHCodeSample_code notranslate cm-s-default"><pre><span class="cm-operator">/</span><span class="cm-variable">opt</span><span class="cm-operator">/</span><span class="cm-variable">cloudbolt</span><span class="cm-operator">/</span><span class="cm-variable">utilities</span><span class="cm-operator">/</span><span class="cm-variable">maintenance_mode</span><span class="cm-variable">.py</span> <span class="cm-variable">on</span> <span class="cm-operator">-</span><span class="cm-variable">t</span> <span class="cm-string">"Database Migration in Progress"</span> <span class="cm-operator">-</span><span class="cm-variable">b</span> <span class="cm-string">"CloudBolt database is being migrated."</span></pre></td></tr></table>
        </li>
        <li>
          Stop Job Engine processes on all nodes after all existing running jobs complete:
          <ul>
            <li>
              Change directory to the root directory where the upgrader was extracted and execute the following commands:
              <ol>
                <li>
                  To check for running jobs, execute the following command to get the total number of running jobs <table class="CHCodeSample_container notranslate" cellspacing="0" cellpadding="0"><tr class="CHCodeSample_tr1"><td class="CHCodeSample_header"><div class="CHCodeSample_copyCode nonPrintable"><a onclick="copyCodeSample(this)" href="javascript:void(0)">Copy Code</a></div><div class="CHCodeSample_langName notranslate">Bash (Unix Shell)</div></td></tr><tr class="CHCodeSample_tr2"><td class="CHCodeSample_code notranslate cm-s-default"><pre><span class="cm-word">.</span><span class="cm-word">/10</span><span class="cm-attribute">-cloudbolt</span><span class="cm-word">/get_count_of_running_jobs</span><span class="cm-word">.py</span> <span class="cm-attribute">--exclude</span><span class="cm-operator">=</span><span class="cm-word">syncvms</span></pre></td></tr></table>
                </li>
                <li>
                  Once there are no running jobs, execute the following to stop the Job Engine <table class="CHCodeSample_container notranslate" cellspacing="0" cellpadding="0"><tr class="CHCodeSample_tr1"><td class="CHCodeSample_header"><div class="CHCodeSample_copyCode nonPrintable"><a onclick="copyCodeSample(this)" href="javascript:void(0)">Copy Code</a></div><div class="CHCodeSample_langName notranslate">Bash (Unix Shell)</div></td></tr><tr class="CHCodeSample_tr2"><td class="CHCodeSample_code notranslate cm-s-default"><pre><span class="cm-word">supervisorctl</span> <span class="cm-builtin">stop</span> <span class="cm-word">jobengine</span><span class="cm-word">:0</span></pre></td></tr></table>
                </li>
              </ol>
              
            </li>
          </ul>
        </li>
      </ol>
    </li>
  </ul>
</section>
<hr/>
<section>
  <h2 id="h2_1223016999" data-has-heading-anchor="true">
    Database Data Migration
  <a href="postgresql-database.html#h2_1223016999" class="CHHeadingLink" title="Link to this heading" aria-hidden="true"></a></h2>
  <p>
    Existing customers who want to migrate from MySQL to PostgreSQL, follow these steps.
  </p>
  <div class="alert alert-primary">
    <i class="mdi mdi-help-circle mr-2"></i>Plan for a 60-minute maintenance window where CloudBolt will not be available.
  </div>
  <p>
    <b>Remote PostgreSQL Database Information</b>
  </p>
  <p>
    You will be prompted for the following information during the migration:
  </p>
  <ul>
    <li>
      PostgreSQL Host/IP
    </li>
    <li>
      PostgreSQL Port
    </li>
    <li>
      PostgreSQL Database name
    </li>
    <li>
      PostgreSQL Schema
    </li>
    <li>
      PostgreSQL Username
    </li>
    <li>
      PostgreSQL Password
    </li>
  </ul>
  <section>
    <h3 id="h3_1462776239" data-has-heading-anchor="true">
      <br/>
      1. Migrate Data
    <a href="postgresql-database.html#h3_1462776239" class="CHHeadingLink" title="Link to this heading" aria-hidden="true"></a></h3>
    <p>
      Run the following script to migrate your data from MySQL to PostgreSQL using the following script. This script is located at the root directory of the installer.
    </p>
    <p>
      <table class="CHCodeSample_container notranslate" cellspacing="0" cellpadding="0"><tr class="CHCodeSample_tr1"><td class="CHCodeSample_header"><div class="CHCodeSample_copyCode nonPrintable"><a onclick="copyCodeSample(this)" href="javascript:void(0)">Copy Code</a></div><div class="CHCodeSample_langName notranslate">Code</div></td></tr><tr class="CHCodeSample_tr2"><td class="CHCodeSample_code notranslate cm-s-default"><pre># ./migrate_cloudbolt_postgresql.sh</pre></td></tr></table>
      <br/>
    </p>
    <p>
      When prompted for <b>Install Type</b>, type in:
    </p>
    <ul>
      <li>
        <code class="path"><b>1</b></code> for Single Appliance
      </li>
      <li>
        <code class="path"><b>2</b></code> for HA - Distributed
      </li>
      <li>
        <code class="path"><b>3</b></code> to Abort the PostgreSQL Data Migration
      </li>
    </ul>
    
    <p>
      This script creates/updates the following files in your environment:
    </p>
    <ul>
      <li>
        <code class="path">/opt/cloudbolt/install_config</code>: PostgreSQL variables are added.
      </li>
      <li>
        <code class="path">/opt/cloudbolt/settings_local</code>: This is now configured for PostgreSQL.
      </li>
      <li>
        <code class="path">/var/opt/cloudbolt/.postgresql_password</code>: This file contains the passwords for the PostgreSQL Database. This file is owned by root and <b>must not be deleted</b>.
      </li>
      <li>
        <code class="path">/var/opt/cloudbolt/proserv/customer_settings.py</code>: Appends updated database configuration required for the migration. See below for post-migration updates after confirmation.
      </li>
    </ul>
    <div class="card">
      <div class="card-header">
        Example 
      </div>
      <div class="card-body">
        Sample of what is appended to your <code class="path">customer_settings.py</code> file:
        <table class="CHCodeSample_container notranslate" cellspacing="0" cellpadding="0"><tr class="CHCodeSample_tr1"><td class="CHCodeSample_header"><div class="CHCodeSample_copyCode nonPrintable"><a onclick="copyCodeSample(this)" href="javascript:void(0)">Copy Code</a></div><div class="CHCodeSample_langName notranslate">Code</div></td></tr><tr class="CHCodeSample_tr2"><td class="CHCodeSample_code notranslate cm-s-default"><pre>ROOTDIR = os.path.abspath(os.path.dirname(__file__))<br><br>DATABASES = {<br>    "mysql": {<br>        "ENGINE": "django.db.backends.mysql",<br>        "NAME": "cloudbolt",<br>        "USER": "cb_dba",<br>        "PASSWORD": "**********",<br>        "HOST": "localhost",<br>        "PORT": "3306",<br>        "OPTIONS": {<br>            "charset": "utf8mb4",<br>            "init_command": "SET DEFAULT_STORAGE_ENGINE=INNODB; SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED"<br>        },<br>        "ATOMIC_REQUESTS": False,<br>        "AUTOCOMMIT": True,<br>        "CONN_MAX_AGE": 0,<br>        "TIME_ZONE": None,<br>        "TEST": {<br>            "CHARSET": None,<br>            "COLLATION": None,<br>            "MIGRATE": True,<br>            "MIRROR": None,<br>            "NAME": None<br>        }<br>    },<br>    "pgsql": {<br>        "ENGINE": "django.db.backends.postgresql_psycopg2",<br>        "NAME": "cloudbolt",<br>        "USER": "cb_dba",<br>        "PASSWORD": "********",<br>        "HOST": "localhost",<br>        "PORT": "5432"<br>    }<br>}<br>DATABASES["default"] = DATABASES["pgsql"]</pre></td></tr></table>
      </div>
    </div>
  </section>
  <section>
    <h3 id="h3_592386155" data-has-heading-anchor="true">
      <br/>
      2. Verify Data Migration
    <a href="postgresql-database.html#h3_592386155" class="CHHeadingLink" title="Link to this heading" aria-hidden="true"></a></h3>
    <p>
      Verify your data migration with the provided script (this script is located at the root directory of the installer).&nbsp;
    </p>
    <p>
      <table class="CHCodeSample_container notranslate" cellspacing="0" cellpadding="0"><tr class="CHCodeSample_tr1"><td class="CHCodeSample_header"><div class="CHCodeSample_copyCode nonPrintable"><a onclick="copyCodeSample(this)" href="javascript:void(0)">Copy Code</a></div><div class="CHCodeSample_langName notranslate">Code</div></td></tr><tr class="CHCodeSample_tr2"><td class="CHCodeSample_code notranslate cm-s-default"><pre>./verify_postgresql_migration.sh</pre></td></tr></table>
      <br/>
    </p>
    <p>
      This assists with the verification for the database migration and returns the following:
    </p>
    <ul>
      <li>
        Total Number of Tables
      </li>
      <li>
        Table Row Counts
      </li>
      <li>
        Table Data, compares a max of 20,000 rows per table</li>
      <li>The message: <code class="path">All Data has been successfully migrated</code> to confirm successful migration.
      </li>
    </ul>
  </section>
  <section>
    <h3 id="h3_465749878" data-has-heading-anchor="true">
      3. Confirm Data Migration
    <a href="postgresql-database.html#h3_465749878" class="CHHeadingLink" title="Link to this heading" aria-hidden="true"></a></h3>
    <div class="alert alert-warning">
      <i class="mdi mdi-alert mr-2"></i> If the Data Migration was not successful, proceed to <a href="postgresql-database.html#h2_362899174">Revert Back to MySQL</a>.
    </div>
    <p>
      After you verify the migration, perform the following:
    </p>
    <br/>
    <h4 id="h4__1656890406" data-has-heading-anchor="true">
      3a.Update Customer Settings
    <a href="postgresql-database.html#h4__1656890406" class="CHHeadingLink" title="Link to this heading" aria-hidden="true"></a></h4>
    <ol>
      <li>
        On the server that executed the Data Migration, edit the&nbsp;<code class="path">/var/opt/cloudbolt/proserv/customer_settings.py</code>
        <ul>
          <li>
            <div class="CHBoxShowMore">
              <div class="showMoreLabel nonPrintable" style="margin-top: 10px; margin-bottom: 10px; cursor: pointer; display:table" onclick="toggleBox(this)">
                [+] <a href="javascript:void(0)"> View customer_settings.py file BEFORE making updates</a>    
              </div>
              <div class="hideLabel Article_hiddenBlock nonPrintable" style="margin-top: 10px; margin-bottom: 10px; cursor: pointer; display:table" onclick="toggleBox(this)">
                [-] <a href="javascript:void(0)" target="_top"> View customer_settings.py file BEFORE making updates</a>
              </div>
              <div class="showMoreContent Article_hiddenBlock" style="padding-left: 20px">
                <table class="CHCodeSample_container notranslate" cellspacing="0" cellpadding="0"><tr class="CHCodeSample_tr1"><td class="CHCodeSample_header"><div class="CHCodeSample_copyCode nonPrintable"><a onclick="copyCodeSample(this)" href="javascript:void(0)">Copy Code</a></div><div class="CHCodeSample_langName notranslate">Python</div></td></tr><tr class="CHCodeSample_tr2"><td class="CHCodeSample_code notranslate cm-s-default"><pre># Replace the following DATABASE settings with the following after you confirm the data migration. Also remove any other DATABASE settings defined above.<br># DATABASES = {<br>#     "default": {<br>#         "ENGINE": "django.db.backends.postgresql_psycopg2",<br>#         "NAME": "cloudbolt",<br>#         "USER": "cb_dba",<br>#         "PASSWORD": "QCEHlU832",<br>#         "HOST": "localhost",<br>#         "PORT": "5432"<br>#     }<br># }<br>DATABASES = {<br>    "mysql": {<br>        "ENGINE": "django.db.backends.﻿mysql",<br>        "NAME": "cloudbolt",<br>        "USER": "cb_dba",<br>        "PASSWORD": "QCEHlU832",<br>        "HOST": "localhost",<br>        "PORT": "5432",<br>        "ATOMIC_REQUESTS": False,<br>        "AUTOCOMMIT": True,<br>        "CONN_MAX_AGE": 0,<br>        "OPTIONS": {},<br>        "TIME_ZONE": None,<br>        "TEST": {<br>            "CHARSET": None,<br>            "COLLATION": None,<br>            "MIGRATE": True,<br>            "MIRROR": None,<br>            "NAME": None<br>        }<br>    },<br>    "pgsql": {<br>        "ENGINE": "django.db.backends.postgresql_psycopg2",<br>        "NAME": "cloudbolt",<br>        "USER": "cb_dba",<br>        "PASSWORD": "QCEHlU832",<br>        "HOST": "localhost",<br>        "PORT": "5432"<br>    }<br>}<br>DATABASES["default"] = DATABASES["pgsql"]</pre></td></tr></table>
                <div class="alert alert-info w-75">
                  <i class="mdi mdi-i gnformation mr-2"></i> Only one definition of the DATABASE settings defined in <code class="path">customer_settings.py</code> file should exist.
                </div>
              </div>
            </div>
          </li>
        </ul>
      </li>
      <li>
        <b>Delete</b> the entire DATABASE settings block that is the current settings (most likely will contain entries for both MySQL and PostgreSQL)
      </li>
      <li>
        <b>Uncomment</b> out the commented DATABASE settings section for PostgreSQL (may most likely will be found at the top of the file)
      </li>
      <li>
        The <code class="path">customer_settings.py</code> file should look similar to the example below: <table class="CHCodeSample_container notranslate" cellspacing="0" cellpadding="0"><tr class="CHCodeSample_tr1"><td class="CHCodeSample_header"><div class="CHCodeSample_copyCode nonPrintable"><a onclick="copyCodeSample(this)" href="javascript:void(0)">Copy Code</a></div><div class="CHCodeSample_langName notranslate">Python</div></td></tr><tr class="CHCodeSample_tr2"><td class="CHCodeSample_code notranslate cm-s-default"><pre><span class="cm-variable">DATABASES</span> = {<br>    <span class="cm-string">"default"</span>: {<br>        <span class="cm-string">"ENGINE"</span>: <span class="cm-string">"django.db.backends.postgresql_psycopg2"</span>,<br>        <span class="cm-string">"NAME"</span>: <span class="cm-string">"cloudbolt"</span>,<br>        <span class="cm-string">"USER"</span>: <span class="cm-string">"cb_dba"</span>,<br>        <span class="cm-string">"PASSWORD"</span>: <span class="cm-string">"QCEHlU832"</span>,<br>        <span class="cm-string">"HOST"</span>: <span class="cm-string">"localhost"</span>,<br>        <span class="cm-string">"PORT"</span>: <span class="cm-string">"5432"</span><br>    }<br>}</pre></td></tr></table>
      </li>
      <li>
        For <b>HA Distributed Setups</b>, copy the newly modified <code class="path">customer_settings.py</code> from <b>Step 4</b> and paste it to be the content for all additional Web and Job Engine nodes' <code class="path">/var/opt/cloudbolt/proserv/customer_settings.py</code> files.
      </li>
    </ol>
  </section>
  <section>
    <h3 id="h3_611604668" data-has-heading-anchor="true">
      4. Disable MySQL and Restart Services
    <a href="postgresql-database.html#h3_611604668" class="CHHeadingLink" title="Link to this heading" aria-hidden="true"></a></h3>
    <section>
      <h4 id="h4_1295120108" data-has-heading-anchor="true">
        Single Appliance Setup
      <a href="postgresql-database.html#h4_1295120108" class="CHHeadingLink" title="Link to this heading" aria-hidden="true"></a></h4>
      <p>
        After you verify the data migration, execute the script to perform the following:
      </p>
      <ul>
        <li>
          Stops MySQL Database
        </li>
        <li>
          Disables MySQL Service
        </li>
        <li>
          Disables Maintenance Mode
        </li>
        <li>
          Restarts <code>httpd</code>
        </li>
        <li>
          Starts the Job Engine
        </li>
      </ul>
      <table class="CHCodeSample_container notranslate" cellspacing="0" cellpadding="0"><tr class="CHCodeSample_tr1"><td class="CHCodeSample_header"><div class="CHCodeSample_copyCode nonPrintable"><a onclick="copyCodeSample(this)" href="javascript:void(0)">Copy Code</a></div><div class="CHCodeSample_langName notranslate">Code</div></td></tr><tr class="CHCodeSample_tr2"><td class="CHCodeSample_code notranslate cm-s-default"><pre>./confirm_postgresql_migration.sh</pre></td></tr></table>
    </section>
    <section>
      <h4 id="h4__179856090" data-has-heading-anchor="true">
        HA - Distributed Setup
      <a href="postgresql-database.html#h4__179856090" class="CHHeadingLink" title="Link to this heading" aria-hidden="true"></a></h4>
      <p>
        After you verify the data migration, perform the following commands:
      </p>
      <ol>
        <li>Stop/Disable MySQL on <b>ALL Database</b> nodes:
          <ul><li>Execute the following commands to stop and disable the MySQL database: <table class="CHCodeSample_container notranslate" cellspacing="0" cellpadding="0"><tr class="CHCodeSample_tr1"><td class="CHCodeSample_header"><div class="CHCodeSample_copyCode nonPrintable"><a onclick="copyCodeSample(this)" href="javascript:void(0)">Copy Code</a></div><div class="CHCodeSample_langName notranslate">Code</div></td></tr><tr class="CHCodeSample_tr2"><td class="CHCodeSample_code notranslate cm-s-default"><pre>systemctl stop mysqld<br>systemctl disable mysqld</pre></td></tr></table>
            
            </li></ul>
        </li>
        
        <li>Enable/Restart HTTP Server on<b> ALL Web</b> nodes:
          <ol>
            <li>
              Run the following commands:&nbsp;<table class="CHCodeSample_container notranslate" cellspacing="0" cellpadding="0"><tr class="CHCodeSample_tr1"><td class="CHCodeSample_header"><div class="CHCodeSample_copyCode nonPrintable"><a onclick="copyCodeSample(this)" href="javascript:void(0)">Copy Code</a></div><div class="CHCodeSample_langName notranslate">Bash (Unix Shell)</div></td></tr><tr class="CHCodeSample_tr2"><td class="CHCodeSample_code notranslate cm-s-default"><pre><span class="cm-comment"># Perform these commands on ALL Web nodes to bring HTTP server out of maintenance mode and to restart it.</span><br><span class="cm-word">/opt</span><span class="cm-word">/cloudbolt</span><span class="cm-word">/utilities</span><span class="cm-word">/maintenance_mode</span><span class="cm-word">.py</span> <span class="cm-word">off</span><br><span class="cm-word">systemctl</span> <span class="cm-builtin">restart</span> <span class="cm-word">httpd</span></pre></td></tr></table>
            </li>
          </ol>
        </li>
        <li>
          <p>
            Restart Job Engine on ALL <b>Job Engine</b> nodes:
          </p>
          <ol>
            <li>
              <p>
                Run the following command:<table class="CHCodeSample_container notranslate" cellspacing="0" cellpadding="0"><tr class="CHCodeSample_tr1"><td class="CHCodeSample_header"><div class="CHCodeSample_copyCode nonPrintable"><a onclick="copyCodeSample(this)" href="javascript:void(0)">Copy Code</a></div><div class="CHCodeSample_langName notranslate">Bash (Unix Shell)</div></td></tr><tr class="CHCodeSample_tr2"><td class="CHCodeSample_code notranslate cm-s-default"><pre><span class="cm-comment"># Perform this command on ALL Job Engine nodes to start the Job Engine</span><br><span class="cm-word">supervisorctl</span> <span class="cm-builtin">start</span> <span class="cm-word">jobengine</span><span class="cm-word">:</span><span class="cm-word">*</span></pre></td></tr></table>
              </p>
            </li>
          </ol>
        </li>
      </ol>
    </section>
  </section>
</section>
<hr class="article-divider"/>
<section>
  <h2 id="h2_362899174" data-has-heading-anchor="true">
    Revert Back to MySQL
  <a href="postgresql-database.html#h2_362899174" class="CHHeadingLink" title="Link to this heading" aria-hidden="true"></a></h2>
  <section>
    <h3 id="h3_1295120108" data-has-heading-anchor="true">
      Single Appliance Setup
    <a href="postgresql-database.html#h3_1295120108" class="CHHeadingLink" title="Link to this heading" aria-hidden="true"></a></h3>
    <p>
      If you experience any issues with your data migration, execute the following script located at the root of the installer. The script performs the following:
    </p>
    <ul>
      <li>
        Stops PostgreSQL
      </li>
      <li>
        Disables PostgreSQL service
      </li>
      <li>
        Reverts configuration files modified by the migration
      </li>
      <li>
        Disables Maintenance Mode
      </li>
      <li>
        Starts the Job Engine
      </li>
    </ul>
    <table class="CHCodeSample_container notranslate" cellspacing="0" cellpadding="0"><tr class="CHCodeSample_tr1"><td class="CHCodeSample_header"><div class="CHCodeSample_copyCode nonPrintable"><a onclick="copyCodeSample(this)" href="javascript:void(0)">Copy Code</a></div><div class="CHCodeSample_langName notranslate">Code</div></td></tr><tr class="CHCodeSample_tr2"><td class="CHCodeSample_code notranslate cm-s-default"><pre>./revert_to_mysql.sh</pre></td></tr></table>
  </section>
  <section>
    <h3 id="h3__179856090" data-has-heading-anchor="true">
      HA - Distributed Setup
    <a href="postgresql-database.html#h3__179856090" class="CHHeadingLink" title="Link to this heading" aria-hidden="true"></a></h3>
    <p>
      If you experience any issues with your data migration, execute the following commands:
    </p>
    <ol>
      <li>
        Stop and disable PostgreSQL on ALL <b>Web</b> nodes:
        <ol>
          <li>
            Run the following command:&nbsp;<table class="CHCodeSample_container notranslate" cellspacing="0" cellpadding="0"><tr class="CHCodeSample_tr1"><td class="CHCodeSample_header"><div class="CHCodeSample_copyCode nonPrintable"><a onclick="copyCodeSample(this)" href="javascript:void(0)">Copy Code</a></div><div class="CHCodeSample_langName notranslate">Bash (Unix Shell)</div></td></tr><tr class="CHCodeSample_tr2"><td class="CHCodeSample_code notranslate cm-s-default"><pre><span class="cm-comment"># Perform this command on ALL Web nodes to stop/disable PostgreSQL</span><br><span class="cm-word">systemctl</span> <span class="cm-builtin">stop</span> <span class="cm-word">postgresql</span><span class="cm-attribute">-14</span><span class="cm-word">;</span> <span class="cm-word">systemctl</span> <span class="cm-word">disable</span> <span class="cm-word">postgresql</span><span class="cm-attribute">-14</span></pre></td></tr></table>
          </li>
        </ol>
      </li>
      <li>
        Enable/Restart HTTP Server on<b>&nbsp;</b>ALL<b> Web</b>&nbsp;nodes:
        <ol>
          <li>
            Run the following commands:&nbsp;<table class="CHCodeSample_container notranslate" cellspacing="0" cellpadding="0"><tr class="CHCodeSample_tr1"><td class="CHCodeSample_header"><div class="CHCodeSample_copyCode nonPrintable"><a onclick="copyCodeSample(this)" href="javascript:void(0)">Copy Code</a></div><div class="CHCodeSample_langName notranslate">Bash (Unix Shell)</div></td></tr><tr class="CHCodeSample_tr2"><td class="CHCodeSample_code notranslate cm-s-default"><pre><span class="cm-comment"># Perform these commands on ALL Web nodes to bring HTTP server out of maintenance mode and to restart it.</span><br><span class="cm-word">/opt</span><span class="cm-word">/cloudbolt</span><span class="cm-word">/utilities</span><span class="cm-word">/maintenance_mode</span><span class="cm-word">.py</span> <span class="cm-word">off</span><br><span class="cm-word">systemctl</span> <span class="cm-builtin">restart</span> <span class="cm-word">httpd</span></pre></td></tr></table>
          </li>
        </ol>
      </li>
      <li>
        Restart Job Engine on ALL <b>Job Engine </b>nodes:
        <ol>
          <li>
            Run the following commands:&nbsp;
            <table class="CHCodeSample_container notranslate" cellspacing="0" cellpadding="0"><tr class="CHCodeSample_tr1"><td class="CHCodeSample_header"><div class="CHCodeSample_copyCode nonPrintable"><a onclick="copyCodeSample(this)" href="javascript:void(0)">Copy Code</a></div><div class="CHCodeSample_langName notranslate">Bash (Unix Shell)</div></td></tr><tr class="CHCodeSample_tr2"><td class="CHCodeSample_code notranslate cm-s-default"><pre><span class="cm-comment"># Perform this command on ALL Job Engine nodes to start the Job Engine</span><br><span class="cm-word">supervisorctl</span> <span class="cm-builtin">start</span> <span class="cm-word">jobengine</span><span class="cm-word">:</span><span class="cm-word">*</span></pre></td></tr></table>
          </li>
        </ol>
      </li>
    </ol>
  </section>
</section>  <div class="articleActions row pt-4 mt-5 mb-4 ml-0">
    <div class="col-6">
      <span class="CHNavCaption">Previous Topic</span><a href="upgrading-cloudbolt.html" class="articleActions_link CHNavLinkPrevious">Upgrading CloudBolt</a>
    </div>
    <div class="col-6 text-right">
      <span class="CHNavCaption">Next Topic</span><a href="upgrading-to-9-x-from-8-x.html" class="articleActions_link CHNavLinkNext">Upgrading to 9.X from 8.X</a>
    </div>
  </div>
</div>
<!-- END ARTICLE CONTAINER -->
<!-- FOOTER -->
<div class="footer">
  <div class="footerInner">
    <div class="container">
      <div class="row">
        <div class="col-6">
          <div class="row">
            <div class="col-12">
              <a href="https://www.cloudbolt.io/" target="_blank">
                <img src="../Storage/cloudbolt-docs/logos/cb-horizontal-white.svg" class="img-fluid footerLogo" alt="CloudBolt"/>
              </a>
            </div>
          </div>
          <div class="row mt-4">
            <div class="col-12">
              <a class="btn btn-social" href="mailto:support@cloudbolt.io" role="button" target="_top">
                <span class="btn-icon"><i class="mdi mdi-face-agent"></i></span>
                support@cloudbolt.io
              </a>
            </div>
          </div>
        </div>
        <div class="col-6">
          <p class="footerTitle">
            About the Company
          </p>
          <p class="footerAbout" data-children-count="1">
            CloudBolt&#39;s hybrid cloud platform for enterprises helps IT admins provide simple to very complex IT resources to end users from a single portal.
          </p>
          <ul class="socials">
            <li class="mr-3">
              <a class="social-link" href="https://www.facebook.com/CloudBoltSoftware/" target="_blank" title="Facebook">
                <i class="mdi mdi-facebook"></i>
              </a>
            </li>
            <li class="mr-3">
              <a class="social-link" href="https://twitter.com/CloudBoltSW" target="_blank" title="Twitter">
                <i class="mdi mdi-twitter"></i>
              </a>
            </li>
            <li class="mr-3">
              <a class="social-link" href="https://www.linkedin.com/company/cloudbolt/" target="_blank" title="LinkedIn">
                <i class="mdi mdi-linkedin"></i>
              </a>
            </li>
            <li>
              <a class="social-link" href="https://github.com/CloudBoltSoftware/cloudbolt-forge" target="_blank" title="GitHub">
                <i class="mdi mdi-github"></i>
              </a>
            </li>
          </ul>
        </div>
      </div>
      <div class="row mt-4">
        <div class="col-12 text-center">
          <span class="copyright mt-5" data-children-count="1">© CloudBolt Software. All rights reserved</span>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
  if (window['initFooter']) {
    initFooter();
  }
</script>
<!-- SCRIPTS -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<script src="../Scripts/project-cloudbolt-docs/lightbox-plus-jquery.min.js"></script>
          </div>
        </article>
      </div>
    </div>
  </div>  
</body>
</html>
