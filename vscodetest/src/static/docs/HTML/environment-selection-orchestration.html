<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="MobileOptimized" content="width">
  <meta name="HandheldFriendly" content="true">
  <script type="text/javascript">
    var addThisScriptUrl = 'https://s7.addthis.com/js/300/addthis_widget.js';
  </script>
  <link rel='shortcut icon' href='../_webHelpImages/cloudbolt-login-logo.png' /><link rel='icon' href='../_webHelpImages/cloudbolt-login-logo.png' />
  <link rel='stylesheet' type='text/css' href='../_webHelpStyles/CHWebHelp.css?t=637806378603891771'/><link rel='stylesheet' type='text/css' href='../_webHelpStyles/CommonControls.css?t=637806378603891771'/><link rel='stylesheet' type='text/css' href='../_webHelpStyles/CommonControls/FontAwesome/css/font-awesome.min-ignore.css?t=637806378603891771'/><link rel='stylesheet' type='text/css' href='../_webHelpStyles/z-Branding.css?t=637806378603891771'/>
  <script  src='../_webHelpScripts/Master/1-script.js?t=637806378603891771' type='text/javascript'></script><script  src='../_webHelpScripts/Master/toc_nav.js?t=637806378603891771' type='text/javascript'></script>
  <link rel="stylesheet" href="https://cdn.materialdesignicons.com/5.0.45/css/materialdesignicons.min.css">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<script src="https://kit.fontawesome.com/68d03bdd6e.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
<script type="text/javascript">//<!--
appendEventHandler(window, 'load', function() {webHelpSelectTocNodeByExtId('environment-selection-orchestration',true);});
//--></script><title>Environment Selection Orchestration</title><script type="text/javascript">//<!--
var articleTitleText='Environment Selection Orchestration';
//--></script><link rel="stylesheet" type="text/css" href="../Styles/article-published.css"/><link rel="stylesheet" type="text/css" href="../Styles/cloudbolt-docs/CloudBoltBranding.css"/><script src="../Scripts/article-published.js" type="text/javascript"></script><script src="../Scripts/cloudbolt-docs/Script1.js" type="text/javascript"></script><script src="../Scripts/cloudbolt-docs/Script2.js" type="text/javascript"></script><meta charset="utf-8"><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
  
</head>
<body class="WebHelp_body">
  <div id="pnlContainer" class="CHOffCanvasPanel_container">
    <div class="CHOffCanvasPanel_content">
      <nav id="pnlOffCanvasNav" class="CHOffCanvasPanel_nav noselect">
        <div id="pnlOffCanvasHeader" class="BaseMaster_offCanvasHeader">
        </div>
        <script  type='text/javascript'>//<!--
window['mobileMenu']=new CHMenu('pnlOffCanvasHeader',{"cssClasses":{"menu":null,"popup":null},"templates":{"itemContent":null,"treeItemContent":null,"dropDownArrow":null},"isMobileViewIfParentOverflow":false,"mobileViewMinWidthThreshold":-1,"selectedItemId":"tabContents","isAllowItemSelection":true,"isEscapeMenuItemText":true,"isUseFontAwesomeIcons":true,"fontAwesomeVersion":"4","isMovePopupToBodyChildLevel":true,"isShowPopupOnHover":false},[{"id":"menuItemMenu","t":"Menu","imgs":{},"c":[],"s":-1,"d":0,"e":0,"isNoFocus":false,"vals":{"_faIconCssClass":""}},{"id":"tabContents","t":"Topics","imgs":{},"c":[],"s":-1,"d":0,"e":0,"isNoFocus":false,"vals":{"_faIconCssClass":""}},{"id":"tabSearch","t":"Search","imgs":{},"c":[],"s":-1,"d":0,"e":0,"isNoFocus":false,"vals":{"_faIconCssClass":""}}]);window['mobileMenu'].onItemClick=function(s,e){webHelpMobileMenuItemClick(s,e);};
//--></script>
        <div id="pnlOffCanvasContent" class="BaseMaster_offCanvasContent">
        </div>        
      </nav>
      <div id="pnlOffCanvasOverlay" class="CHOffCanvasPanel_overlay"></div>
      <nav id="pnlMainMenuContainer" class="BaseMaster_mainMenuContainer">
        <button type="button" aria-label="Show mobile menu" title="Show mobile menu" id="btnMobileMenu" style="display:none"
          class="CHHamburger_container CHHamburger_container-htla BaseMaster_hamburgerMenuIcon">
          <span></span>
        </button>
        <a title='CloudBolt Software' href='https://cloudbolt.io' target='_blank'><img alt='CloudBolt Software' class='BaseMaster_imgLogo' src='../_webHelpImages/cloudbolt_line_transparent_white_FINAL.png' /></a>
        <div id="pnlMainMenu" class="BaseMaster_pnlMainMenu"></div>
        <script  type='text/javascript'>//<!--
window['mainMenu']=new CHMenu('pnlMainMenu',{"cssClasses":{"menu":null,"popup":null},"templates":{"itemContent":null,"treeItemContent":null,"dropDownArrow":null},"isMobileViewIfParentOverflow":true,"mobileViewMinWidthThreshold":979,"selectedItemId":null,"isAllowItemSelection":false,"isEscapeMenuItemText":true,"isUseFontAwesomeIcons":true,"fontAwesomeVersion":"4","isMovePopupToBodyChildLevel":true,"isShowPopupOnHover":false},[{"id":"926ab37c-af98-eab8-2cb6-f0224c32b59e","t":"Getting Support","imgs":{},"c":[],"s":0,"d":0,"e":1,"isNoFocus":false,"vals":{"actionType":"OpenLink","_customCssClass":null,"_url":"https://support.cloudbolt.io/","_target":"_blank"}},{"id":"a93dc193-cfa0-0c55-dc87-ef748c016d3e","t":"CloudBolt API","imgs":{},"c":[],"s":0,"d":0,"e":1,"isNoFocus":false,"vals":{"actionType":"OpenArticle","_customCssClass":null,"_url":"http://docs.cloudbolt.io/articles/cloudbolt-latest-docs/cloudbolt-api-v3","_target":"_blank"}},{"id":"1d7d67de-8445-1336-084c-3d22cc440080","t":"Documentation Portal","imgs":{},"c":[],"s":0,"d":0,"e":1,"isNoFocus":false,"vals":{"actionType":"OpenLink","_customCssClass":null,"_url":"https://docs.cloudbolt.io/"}},{"id":"d4ac0703-4b0e-d846-4521-45b57775c8f2","t":"Knowledge Base","imgs":{},"c":[],"s":0,"d":0,"e":1,"isNoFocus":false,"vals":{"actionType":"OpenLink","_customCssClass":null,"_url":"https://support.cloudbolt.io/hc/en-us/sections/201319545-Knowledge-Base","_target":"_blank"}}]);window['mainMenu'].onViewSwitched=function(s,e){webHelpMasterPageMainMenuViewSwitched(s,e);};
//--></script>
        <div class="WebHelp_searchBoxContainer">
          <input id="edtSearch" type="search" class="WebHelp_searchBox" aria-label="Search" />
          <button id="btnSearch" class="btnSearch" alt="Search" title="Search" aria-label="Search" href="javascript:void(0)"></button>
        </div>
      </nav>
      <div id="pnlContentContainer" class="BaseMaster_contentContainer clearfix">
        <nav id="pnlArticlesNav" class="WebHelp_navPanel">
          <div id="pnlNavTabs" class="WebHelp_navMenu"></div>
          <script  type='text/javascript'>//<!--
window['navMenu']=new CHMenu('pnlNavTabs',{"cssClasses":{"menu":null,"popup":null},"templates":{"itemContent":null,"treeItemContent":null,"dropDownArrow":null},"isMobileViewIfParentOverflow":false,"mobileViewMinWidthThreshold":-1,"selectedItemId":"tabContents","isAllowItemSelection":true,"isEscapeMenuItemText":true,"isUseFontAwesomeIcons":true,"fontAwesomeVersion":"4","isMovePopupToBodyChildLevel":true,"isShowPopupOnHover":false},[{"id":"tabContents","t":"Topics","imgs":{},"c":[],"s":-1,"d":0,"e":0,"isNoFocus":false,"vals":{"_faIconCssClass":""}},{"id":"tabSearch","t":"Search","imgs":{},"c":[],"s":-1,"d":0,"e":0,"isNoFocus":false,"vals":{"_faIconCssClass":""}}]);window['navMenu'].onItemClick=function(s,e){webHelpNavMenuItemClick(s,e);};
//--></script>
          <div id="pnlTocContainer" class="WebHelp_navPanelContent ArticleSelector_tabContent TocTreeLight_container">
            <div id="pnlToc"></div>
          </div>
          <div id="pnlIndex" class="WebHelp_navPanelContent ArticleSelector_tabContent" style="display:none">
            <iframe id="frameIndex" style="height: 100%; width:100%; display:block;" frameborder="0"></iframe>
          </div>
          <div id="pnlSearch" class="WebHelp_navPanelContent ArticleSelector_tabContent" style="display:none">
            <iframe id="frameSearch" style="height: 100%; width:100%; display: block;" frameborder="0"></iframe>
          </div>
        </nav>
        <article class="TopicViewer_container">
          <header id="pnlTopicHeader" class="TopicViewer_header"  style='display:none'>
            <div id="pnlSocial" class="TopicViewer_headerShare">Share: </div>
            <div class="TopicViewer_headerText">
              <div class="ArticleEditor_projectName">cloudbolt_docs</div>
              <strong id="pnlTitle" class="ArticleEditor_title">Environment Selection Orchestration</strong>
              <button type="button" id="btnPrint" class="CHImageButton ArticleEditor_imageButton ArticleEditor_fontAwesomeButton ArticleEditor_btnPrint" title="Print this topic">
                <i class="fa fa-print"></i>
              </button>
            </div>
          </header>
          <div id="pnlTopicContentContainer" class="TopicViewer_contentContainer">
            <!-- START ARTICLE CONTAINER -->
<div class="container">
  <div class="articleBreadcrumb">
    <span class="CHBreadcrumb"><span class="CHBreadcrumb_item CHBreadcrumb_itemHome"><a href="/" target="_top">Home</a></span><span class="CHBreadcrumb_separator">›</span><span class="CHBreadcrumb_item">Using CloudBolt</span><span class="CHBreadcrumb_separator">›</span><span class="CHBreadcrumb_item"><a href="orchestration.html">Orchestration</a></span><span class="CHBreadcrumb_separator">›</span><span class="CHBreadcrumb_item CHBreadcrumb_itemSelf">Environment Selection Orchestration</span></span>
  </div><div id="using-orchestration-actions-to-determine-the-best-execution-venue-environment">
  <h1 id="h1__1721981029" data-has-heading-anchor="true"> Environment Selection Orchestration <a href="environment-selection-orchestration.html#h1__1721981029" class="CHHeadingLink" title="Link to this heading" aria-hidden="true"></a></h1> When creating or editing a Blueprint, it is possible to determine that one or more&nbsp;Server Tier&nbsp;items should use an orchestration to determine the target&nbsp;<strong>Environment</strong>&nbsp;and even the&nbsp;<strong>OS Build*</strong>&nbsp;and additional&nbsp;<strong>Parameters</strong>. This is done by editing the&nbsp;<strong>Environment Selection Orchestration</strong>&nbsp;attribute of the Server Tier. <br/><br/><hr/><h2 id="h2_1238680777" data-has-heading-anchor="true">Ordering Through the API <a href="environment-selection-orchestration.html#h2_1238680777" class="CHHeadingLink" title="Link to this heading" aria-hidden="true"></a></h2> When ordering a Blueprint with an Environment Selection Orchestration on one or more Server Tiers through the API, you can and should exclude the environment key from the Order JSON. If you pass an Environment in the JSON for a Server Tier, it will use that Environment for the Order and ignore the Environment Selection Orchestration. <br/><br/><hr/><h2 id="h2_1238680777" data-has-heading-anchor="true">Keyword Arguments <a href="environment-selection-orchestration.html#h2_1238680777" class="CHHeadingLink" title="Link to this heading" aria-hidden="true"></a></h2>
  <p> The following table lists the most common keyword arguments and the context in which they are available. </p>
  <div class="wy-table-responsive" style="box-sizing: border-box; margin-bottom: 24px; max-width: 100%; overflow: auto;">
    <table border="1" class="docutils" style="box-sizing: border-box; border-collapse: collapse; border-spacing: 0px; margin-bottom: 24px; border: 1px solid #e1e4e5;">
      <colgroup style="box-sizing: border-box;">
        <col width="12%" style="box-sizing: border-box;"/>
        <col width="88%" style="box-sizing: border-box;"/>
      </colgroup>
      <thead valign="bottom" style="box-sizing: border-box; text-align: left; white-space: nowrap;">
        <tr class="row-odd" style="box-sizing: border-box;">
          <th class="head" style="box-sizing: border-box; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; border-color: #e1e4e5; border-bottom-width: 2px; border-bottom-style: solid; border-left-width: 0px;"> Keyword </th>
          <th class="head" style="box-sizing: border-box; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; border-color: #e1e4e5; border-bottom-width: 2px; border-bottom-style: solid;"> Availability Context </th>
        </tr>
      </thead>
      <tbody valign="top" style="box-sizing: border-box;">
        <tr class="row-even" style="box-sizing: border-box;">
          <td style="box-sizing: border-box; vertical-align: middle; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; background-color: #f3f6f6; border-bottom: 1px solid #e1e4e5; border-left: 0px solid #e1e4e5;"> group </td>
          <td style="box-sizing: border-box; vertical-align: middle; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; background-color: #f3f6f6; border-bottom: 1px solid #e1e4e5; border-left: 1px solid #e1e4e5;"> The Group this deployment order is for. </td>
        </tr>
        <tr class="row-odd" style="box-sizing: border-box;">
          <td style="box-sizing: border-box; vertical-align: middle; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; border-bottom: 1px solid #e1e4e5; border-left: 0px solid #e1e4e5;"> profile </td>
          <td style="box-sizing: border-box; vertical-align: middle; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; border-bottom: 1px solid #e1e4e5; border-left: 1px solid #e1e4e5;"> The profile of the user that requested the order. </td>
        </tr>
        <tr class="row-even" style="box-sizing: border-box;">
          <td style="box-sizing: border-box; vertical-align: middle; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; background-color: #f3f6f6; border-bottom: 1px solid #e1e4e5; border-left: 0px solid #e1e4e5;"> blueprint </td>
          <td style="box-sizing: border-box; vertical-align: middle; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; background-color: #f3f6f6; border-bottom: 1px solid #e1e4e5; border-left: 1px solid #e1e4e5;"> The Blueprint being deployed. </td>
        </tr>
        <tr class="row-odd" style="box-sizing: border-box;">
          <td style="box-sizing: border-box; vertical-align: middle; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; border-bottom: 1px solid #e1e4e5; border-left: 0px solid #e1e4e5;"> server_tier </td>
          <td style="box-sizing: border-box; vertical-align: middle; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; border-bottom: 1px solid #e1e4e5; border-left: 1px solid #e1e4e5;"> The tier for which we are determining what Environment to use. </td>
        </tr>
        <tr class="row-even" style="box-sizing: border-box;">
          <td style="box-sizing: border-box; vertical-align: middle; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; background-color: #f3f6f6; border-bottom: 1px solid #e1e4e5; border-left: 0px solid #e1e4e5;"> os_build </td>
          <td style="box-sizing: border-box; vertical-align: middle; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; background-color: #f3f6f6; border-bottom: 1px solid #e1e4e5; border-left: 1px solid #e1e4e5;"> The os_build defined on the order for this tier. </td>
        </tr>
        <tr class="row-odd" style="box-sizing: border-box;">
          <td style="box-sizing: border-box; vertical-align: middle; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; border-bottom: 1px solid #e1e4e5; border-left: 0px solid #e1e4e5;"> cfvs </td>
          <td style="box-sizing: border-box; vertical-align: middle; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; border-bottom: 1px solid #e1e4e5; border-left: 1px solid #e1e4e5;"> A list of custom field values representing all the parameters being used in the order for this tier. </td>
        </tr>
        <tr class="row-even" style="box-sizing: border-box;">
          <td style="box-sizing: border-box; vertical-align: middle; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; background-color: #f3f6f6; border-bottom: 0px solid #e1e4e5; border-left: 0px solid #e1e4e5;"> resource </td>
          <td style="box-sizing: border-box; vertical-align: middle; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; background-color: #f3f6f6; border-bottom: 0px solid #e1e4e5; border-left: 1px solid #e1e4e5;"> The deployed resource created as part of the order, if it exists </td>
        </tr>
      </tbody>
    </table>
  </div>
  
</div>
<div id="action-return">
  <h2 id="h2__225514846"> </h2><hr/><h2 id="h2__1006462262" data-has-heading-anchor="true">Action Return <a href="environment-selection-orchestration.html#h2__1006462262" class="CHHeadingLink" title="Link to this heading" aria-hidden="true"></a></h2>
  <p> The Auto-Select Environment action is expected to always return a dictionary. CloudBolt understands the following keys: </p>
  <div class="wy-table-responsive" style="box-sizing: border-box; margin-bottom: 24px; max-width: 100%; overflow: auto;">
    <table border="1" class="docutils" style="box-sizing: border-box; border-collapse: collapse; border-spacing: 0px; margin-bottom: 24px; border: 1px solid #e1e4e5; width: 1328px; height: 146px;">
      <colgroup style="box-sizing: border-box;">
        <col width="12%" style="box-sizing: border-box;"/>
        <col width="6%" style="box-sizing: border-box;"/>
        <col width="82%" style="box-sizing: border-box;"/>
      </colgroup>
      <thead valign="bottom" style="box-sizing: border-box; text-align: left; white-space: nowrap;">
        <tr class="row-odd" style="box-sizing: border-box;">
          <th class="head" style="box-sizing: border-box; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; border-color: #e1e4e5; border-bottom-width: 2px; border-bottom-style: solid; border-left-width: 0px;"> Key </th>
          <th class="head" style="box-sizing: border-box; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; border-color: #e1e4e5; border-bottom-width: 2px; border-bottom-style: solid;"> Type </th>
          <th class="head" style="box-sizing: border-box; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; border-color: #e1e4e5; border-bottom-width: 2px; border-bottom-style: solid;"> Purpose </th>
        </tr>
      </thead>
      <tbody valign="top" style="box-sizing: border-box;">
        <tr class="row-even" style="box-sizing: border-box;">
          <td style="box-sizing: border-box; vertical-align: middle; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; background-color: #f3f6f6; border-bottom: 1px solid #e1e4e5; border-left: 0px solid #e1e4e5;"> environment </td>
          <td style="box-sizing: border-box; vertical-align: middle; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; background-color: #f3f6f6; border-bottom: 1px solid #e1e4e5; border-left: 1px solid #e1e4e5;"> object </td>
          <td style="box-sizing: border-box; vertical-align: middle; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; background-color: #f3f6f6; border-bottom: 1px solid #e1e4e5; border-left: 1px solid #e1e4e5;"> the&nbsp;<span class="guilabel" style="box-sizing: border-box; border: 1px solid #7fbbe3; background: #e7f2fa; font-size: 11.52px; font-weight: 700; border-radius: 4px; padding: 2.4px 6px; margin: auto 2px;">Environment</span>&nbsp;object where servers for this tier should be provisioned. </td>
        </tr>
        <tr class="row-odd" style="box-sizing: border-box;">
          <td style="box-sizing: border-box; vertical-align: middle; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; border-bottom: 1px solid #e1e4e5; border-left: 0px solid #e1e4e5;"> parameters </td>
          <td style="box-sizing: border-box; vertical-align: middle; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; border-bottom: 1px solid #e1e4e5; border-left: 1px solid #e1e4e5;"> dict </td>
          <td style="box-sizing: border-box; vertical-align: middle; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; border-bottom: 1px solid #e1e4e5; border-left: 1px solid #e1e4e5;"> a list of key-value pairs that should be used as part of fulfilling the order. It may include environment specific parameters like&nbsp;<cite style="box-sizing: border-box;">instance_type</cite>&nbsp;if the&nbsp;<strong style="box-sizing: border-box;">environment</strong>&nbsp;returned is an AWS region for instance. </td>
        </tr>
        <tr class="row-even" style="box-sizing: border-box;">
          <td style="box-sizing: border-box; vertical-align: middle; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; background-color: #f3f6f6; border-bottom: 0px solid #e1e4e5; border-left: 0px solid #e1e4e5;"> os-build </td>
          <td style="box-sizing: border-box; vertical-align: middle; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; background-color: #f3f6f6; border-bottom: 0px solid #e1e4e5; border-left: 1px solid #e1e4e5;"> object </td>
          <td style="box-sizing: border-box; vertical-align: middle; white-space: nowrap; font-size: 14.4px; padding: 8px 16px; background-color: #f3f6f6; border-bottom: 0px solid #e1e4e5; border-left: 1px solid #e1e4e5;"> the&nbsp;<span class="guilabel" style="box-sizing: border-box; border: 1px solid #7fbbe3; background: #e7f2fa; font-size: 11.52px; font-weight: 700; border-radius: 4px; padding: 2.4px 6px; margin: auto 2px;">OS Build</span>&nbsp;object to use when provisioning servers for this tier. It’s the action writer’s responsibility to make sure the&nbsp;<strong style="box-sizing: border-box;">os-build</strong>&nbsp;returned is compatible with the&nbsp;<strong style="box-sizing: border-box;">environment</strong>&nbsp;returned.</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div id="developer-tip">
    <h2 id="h2__1888163589"> </h2><hr/><h2 id="h2__1888163589" data-has-heading-anchor="true">Developer Tip <a href="environment-selection-orchestration.html#h2__1888163589" class="CHHeadingLink" title="Link to this heading" aria-hidden="true"></a></h2>
    <p> The return dictionary is strikingly similar to the API payload for a server tier when deploying a Blueprint via the&nbsp;<a href="cloudbolt-api-v2-0.html">CloudBolt REST API</a>. A simple way to get started is to bring up, in the Web UI, a recent order for the Blueprint and execute the following steps: </p>
    <ol>
      <li> Using the&nbsp;API&nbsp;button, check the payload for the order. </li>
      <li> Copy the dictionary related to the tier you are writing the orchestration for. </li>
      <li> Replace the ‘environment’ and ‘os_build’ values with actual objects instead of their&nbsp;<strong>api href representations<br/><br/></strong>
      </li>
    </ol>
  </div>
  <div id="example" data-children-count="1">
    <hr/><h2 id="h2_1689083776" data-has-heading-anchor="true">Example <a href="environment-selection-orchestration.html#h2_1689083776" class="CHHeadingLink" title="Link to this heading" aria-hidden="true"></a></h2>
    <p> In this example&nbsp;scenario, someone has decided that the Environment placement for a given server should always be the cluster with the least total of vms. </p>
    <table class="CHCodeSample_container notranslate" cellspacing="0" cellpadding="0"><tr class="CHCodeSample_tr1"><td class="CHCodeSample_header"><div class="CHCodeSample_copyCode nonPrintable"><a onclick="copyCodeSample(this)" href="javascript:void(0)">Copy Code</a></div><div class="CHCodeSample_langName notranslate">Python</div></td></tr><tr class="CHCodeSample_tr2"><td class="CHCodeSample_code notranslate cm-s-default"><pre><span class="cm-keyword">from</span> <span class="cm-variable">common</span><span class="cm-variable">.methods</span> <span class="cm-keyword">import</span> <span class="cm-variable">set_progress</span><br><span class="cm-keyword">from</span> <span class="cm-variable">infrastructure</span><span class="cm-variable">.models</span> <span class="cm-keyword">import</span> <span class="cm-variable">Environment</span><br><span class="cm-keyword">from</span> <span class="cm-variable">utilities</span><span class="cm-variable">.logger</span> <span class="cm-keyword">import</span> <span class="cm-variable">ThreadLogger</span><br><span class="cm-keyword">from</span> <span class="cm-variable">resourcehandlers</span><span class="cm-variable">.vmware</span><span class="cm-variable">.models</span> <span class="cm-keyword">import</span> <span class="cm-variable">VsphereResourceHandler</span><br><br><span class="cm-variable">RESOURCE_HANDLER_ID</span> = <span class="cm-number">7</span><br><span class="cm-variable">CLUSTER_ONE</span> = <span class="cm-string">'CORP-DEV'</span><br><span class="cm-variable">CLUSTER_TWO</span> = <span class="cm-string">'CORP-PROD'</span><br><br><span class="cm-variable">logger</span> = <span class="cm-variable">ThreadLogger</span>(<span class="cm-variable">__name__</span>)<br><br><span class="cm-keyword">def</span> <span class="cm-variable">determine_deployment_environment_and_parameters</span>(<span class="cm-operator">*</span><span class="cm-variable">args</span>, <span class="cm-operator">**</span><span class="cm-variable">kwargs</span>):<br><br>    <span class="cm-variable">logger</span><span class="cm-variable">.info</span>(<span class="cm-string">"args are {}"</span><span class="cm-variable">.format</span>(<span class="cm-variable">args</span>))<br>    <span class="cm-variable">logger</span><span class="cm-variable">.info</span>(<span class="cm-string">"kwargs are {}"</span><span class="cm-variable">.format</span>(<span class="cm-variable">kwargs</span>))<br><br>    <span class="cm-comment"># Gather the VMs for each cluster</span><br>    <span class="cm-variable">rh</span> = <span class="cm-variable">VsphereResourceHandler</span><span class="cm-variable">.objects</span><span class="cm-variable">.get</span>(<span class="cm-builtin">id</span>=<span class="cm-variable">RESOURCE_HANDLER_ID</span>)<br>    <span class="cm-variable">env_one</span> = <span class="cm-variable">rh</span><span class="cm-variable">.get_api_wrapper</span>()<span class="cm-variable">.get_vms_for_cluster</span>(<span class="cm-variable">CLUSTER_ONE</span>)<br>    <span class="cm-variable">env_two</span> = <span class="cm-variable">rh</span><span class="cm-variable">.get_api_wrapper</span>()<span class="cm-variable">.get_vms_for_cluster</span>(<span class="cm-variable">CLUSTER_TWO</span>)<br><br>    <span class="cm-comment"># Choose the cluster that has less VMs</span><br>    <span class="cm-keyword">if</span> <span class="cm-builtin">len</span>(<span class="cm-variable">env_one</span>) <span class="cm-operator">&lt;</span> <span class="cm-builtin">len</span>(<span class="cm-variable">env_two</span>):<br>        <span class="cm-variable">cluster</span> = <span class="cm-variable">CLUSTER_ONE</span><br>    <span class="cm-keyword">else</span>:<br>        <span class="cm-variable">cluster</span> = <span class="cm-variable">CLUSTER_TWO</span><br><br>    <span class="cm-comment"># Use the first environment linked to the less-used cluster</span><br>    <span class="cm-variable">env</span> = <span class="cm-variable">Environment</span><span class="cm-variable">.objects</span><span class="cm-variable">.filter</span>(<span class="cm-variable">vmware_cluster</span>=<span class="cm-variable">cluster</span>)<span class="cm-variable">.first</span>()<br><br>    <span class="cm-variable">parameters</span> = {<br>        <span class="cm-string">"cpu_cnt"</span>: <span class="cm-string">"1"</span>,<br>        <span class="cm-string">"disk_size"</span>: <span class="cm-string">"16 GB"</span>,<br>        <span class="cm-string">"mem_size"</span>: <span class="cm-string">"512 MB"</span>,<br>    }<br><br>    <span class="cm-keyword">return</span> {<span class="cm-string">"environment"</span>: <span class="cm-variable">env</span>, <span class="cm-string">"parameters"</span>: <span class="cm-variable">parameters</span>}</pre></td></tr></table></div></div>  <div class="articleActions row pt-4 mt-5 mb-4 ml-0">
    <div class="col-6">
      <span class="CHNavCaption">Previous Topic</span><a href="examples.html" class="articleActions_link CHNavLinkPrevious">Examples</a>
    </div>
    <div class="col-6 text-right">
      <span class="CHNavCaption">Next Topic</span><a href="power-scheduling-servers.html" class="articleActions_link CHNavLinkNext">Schedule Power On / Off</a>
    </div>
  </div>
</div>
<!-- END ARTICLE CONTAINER -->
<!-- FOOTER -->
<div class="footer">
  <div class="footerInner">
    <div class="container">
      <div class="row">
        <div class="col-6">
          <div class="row">
            <div class="col-12">
              <a href="https://www.cloudbolt.io/" target="_blank">
                <img src="../Storage/cloudbolt-docs/logos/cb-horizontal-white.svg" class="img-fluid footerLogo" alt="CloudBolt"/>
              </a>
            </div>
          </div>
          <div class="row mt-4">
            <div class="col-12">
              <a class="btn btn-social" href="mailto:support@cloudbolt.io" role="button" target="_top">
                <span class="btn-icon"><i class="mdi mdi-face-agent"></i></span>
                support@cloudbolt.io
              </a>
            </div>
          </div>
        </div>
        <div class="col-6">
          <p class="footerTitle">
            About the Company
          </p>
          <p class="footerAbout" data-children-count="1">
            CloudBolt&#39;s hybrid cloud platform for enterprises helps IT admins provide simple to very complex IT resources to end users from a single portal.
          </p>
          <ul class="socials">
            <li class="mr-3">
              <a class="social-link" href="https://www.facebook.com/CloudBoltSoftware/" target="_blank" title="Facebook">
                <i class="mdi mdi-facebook"></i>
              </a>
            </li>
            <li class="mr-3">
              <a class="social-link" href="https://twitter.com/CloudBoltSW" target="_blank" title="Twitter">
                <i class="mdi mdi-twitter"></i>
              </a>
            </li>
            <li class="mr-3">
              <a class="social-link" href="https://www.linkedin.com/company/cloudbolt/" target="_blank" title="LinkedIn">
                <i class="mdi mdi-linkedin"></i>
              </a>
            </li>
            <li>
              <a class="social-link" href="https://github.com/CloudBoltSoftware/cloudbolt-forge" target="_blank" title="GitHub">
                <i class="mdi mdi-github"></i>
              </a>
            </li>
          </ul>
        </div>
      </div>
      <div class="row mt-4">
        <div class="col-12 text-center">
          <span class="copyright mt-5" data-children-count="1">© CloudBolt Software. All rights reserved</span>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
  if (window['initFooter']) {
    initFooter();
  }
</script>
<!-- SCRIPTS -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<script src="../Scripts/project-cloudbolt-docs/lightbox-plus-jquery.min.js"></script>
          </div>
        </article>
      </div>
    </div>
  </div>  
</body>
</html>
